{% extends "index.html" %}
{% block content %}

<form method="post">
	<table>
		<tr>
			<th>Copy Settings - camera to Pi</th>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Copy day:</div>
				<div class="alignright">
					<select name="copyDay" id="copyDay" onchange="newSelected(this.id)">
					{% for day in ['Off', 'Daily', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
						<option value="{{ day }}"{% if day == copyDay %} SELECTED{% endif %}>{{ day }}</option>
					{% endfor %}
					</select>
				</div>
			</td>
		</tr>
		<tr id="showHideCopyHour">
			<td>
				<div class="alignleft">Copy hour:</div>
				<div class="alignright">
					<select name="copyHour" id="copyHour" onchange="newSelected(this.id)">
						{% for hour in ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'] %}
							<option value="{{ hour }}"{% if hour == copyHour %} SELECTED{% endif %}>{{ hour }}</option>
						{% endfor %}
					</select>
				</div>
			</td>
		</tr>
		{% if wakePiTime != '25' %}
		<tr>
			<td class="noborder">(A copy takes place each day at {{wakePiTime}}:00 when the Pi starts.)</td>
		</tr>
		{% endif %}
	</table>
	
	<table>
		<tr>
			<th>Transfer Settings - from the Pi</th>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Upload method:</div>
				<div class="alignright">
					<select name="tfrMethod" id="tfrMethod" onchange="newSelected(this.id)">
					{% for method in ['sftp','fileshare', 'manual'] %}
						<option value="{{ method }}"{% if method == tfrMethod %} SELECTED{% endif %}>{{ method }}</option>"
					{% endfor %}
					</select>
				</div>
			</td>
		</tr>
	</table>

	<table id="sftp">
		<tr>
			<td>
				<div class="alignleft">SFTP server URL:</div>
				{% if sftpServer == '' %}
					<div class="alignright"><input type="text" name="sftpServer" id="sftpServer" value="ftp.somewhere.com" oninput="newText(this.id)"></div>
				{% else %}
					<div class="alignright"><input type="text" name="sftpServer" id="sftpServer" value="{{ sftpServer }}" oninput="newText(this.id)"></div>
				{% endif %}	
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Username:</div>
				{% if sftpUser == '' %}
					<div class="alignright"><input type="text" name="sftpUser" id="sftpUser" value="ftp_user" oninput="newText(this.id)"></div>
				{% else %}
					<div class="alignright"><input type="text" name="sftpUser" id="sftpUser" value="{{ sftpUser }}" oninput="newText(this.id)"></div>
				{% endif %}	
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Password:</div>
				{% if sftpPassword == '' %}
					<div class="alignright"><input type="password" name="sftpPassword" id="sftpPassword" value="" oninput="newText(this.id)"></div>
				{% else %}
					<div class="alignright"><input type="password" name="sftpPassword" id="sftpPassword" value="{{ sftpPassword }}" oninput="newText(this.id)"></div>
				{% endif %}	
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Transfer day:</div>
				<div class="alignright">
					<select name="sftpDay" id="sftpDay" onchange="newSelected(this.id)">
					{% for day in ['Daily','Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
						<option value="{{ day }}"{% if day == sftpDay %} SELECTED{% endif %}>{{ day }}</option>
					{% endfor %}
					</select>
				</div>
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Transfer hour:</div>
				<div class="alignright">
					<select name="sftpHour" id="sftpHour" onchange="newSelected(this.id)">
						{% for hour in ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'] %}
							<option value="{{ hour }}"{% if hour == sftpHour %} SELECTED{% endif %}>{{ hour }}</option>
						{% endfor %}
					</select>
				</div>
			</td>
		</tr>
	</table>

	<table id="file">
		<tr>
			<td>
				<div class="alignleft">File share path:</div>
				{% if fileServer == '' %}
					<div class="alignright"><input type="text" name="fileServer" id="fileServer" value="\\server\folder\" oninput="newText(this.id)"></div>
				{% else %}
					<div class="alignright"><input type="text" name="fileServer" id="fileServer" value="{{ fileServer }}" oninput="newText(this.id)"></div>
				{% endif %}	
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Username:</div>
				{% if fileUser == '' %}
					<div class="alignright"><input type="text" name="fileUser" id="fileUser" value="folder_user" oninput="newText(this.id)"></div>
				{% else %}
					<div class="alignright"><input type="text" name="fileUser" id="fileUser" value="{{ fileUser }}" oninput="newText(this.id)"></div>
				{% endif %}	
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Password:</div>
				{% if filePassword == '' %}
					<div class="alignright"><input type="password" name="filePassword" id="filePassword" value="" oninput="newText(this.id)"></div>
				{% else %}
					<div class="alignright"><input type="password" name="filePassword" id="filePassword" value="{{ filePassword }}" oninput="newText(this.id)"></div>
				{% endif %}	
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Transfer day:</div>
				<div class="alignright">
					<select name="fileDay" id="fileDay" onchange="newSelected(this.id)">
					{% for day in ['Daily', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
						<option value="{{ day }}"{% if day == fileDay %} SELECTED{% endif %}>{{ day }}</option>
					{% endfor %}
					</select>
				</div>
			</td>
		</tr>
		<tr>
			<td>
				<div class="alignleft">Transfer hour:</div>
				<div class="alignright">
					<select name="fileHour" id="fileHour" onchange="newSelected(this.id)">
						{% for hour in ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'] %}
							<option value="{{ hour }}"{% if hour == fileHour %} SELECTED{% endif %}>{{ hour }}</option>
						{% endfor %}
					</select>
				</div>
			</td>
		</tr>
	</table>
	
	<table class="noborder">
		<tr>
			<td class="noborder">
				<div class="alignleft">
					<button type="button" name="copy" id="copy" onclick="copyNow()">Copy now</button>
				</div>
				<div class="alignright">
					<button type="submit" name="TfrApply" id="apply">Apply</button>
				</div>
			</td>
		</tr>
	</table>
</form>

<!-- Hidden form for the Copy Now button, as you can't nest forms -->
<form style="display: none">
	<button type="submit" name="copyNow" id="copyNow" value="1">Copy Now</button>
</form>

<script>
var SelectionByte = 0;
var SelectionBits = new Array();
SelectionBits["tfrMethod"]    =  1;
SelectionBits["sftpServer"]   =  2;
SelectionBits["sftpUser"]     =  4;
SelectionBits["sftpPassword"] =  8;
SelectionBits["sftpDay"]      =  16;
SelectionBits["sftpHour"]     =  32;
SelectionBits["fileServer"]   =  64;
SelectionBits["fileUser"]     =  128;
SelectionBits["filePassword"] =  256;
SelectionBits["fileDay"]      =  512;
SelectionBits["fileHour"]     =  1024;
SelectionBits["copyDay"]      =  2048;
SelectionBits["copyHour"]     =  4096;

var method = document.getElementById("tfrMethod");
var copyDay = document.getElementById("copyDay");
var showHideCopyHour = document.getElementById("showHideCopyHour");
var sftp = document.getElementById("sftp");
var file = document.getElementById("file");
// This drives the default display on load:
sftp.style.display = (method.value != "sftp") ? "none":"";
file.style.display = (method.value != "fileshare") ? "none":"";
showHideCopyHour.style.display = (copyDay.value == "Off") ? "none":"";

// Run when the form first loads:
lightButtons(); 

function copyNow()
{
	document.getElementById("copyNow").click();
}

function newSelected(id)
{
	var option = document.getElementById(id);
	// Reveal/hide fields as appropriate:
	if (id == "tfrMethod")
	{
		sftp.style.display = (method.value != "sftp") ? "none":"";
		file.style.display = (method.value != "fileshare") ? "none":"";
	}
	if (id == "copyDay")
	{
		showHideCopyHour.style.display = (copyDay.value == "Off") ? "none":"";
	}

	if (!option.options[option.selectedIndex].defaultSelected)
	{
		SelectionByte = SelectionByte | SelectionBits[id]; // Or turns the bit on
	}
	else
	{
		SelectionByte = SelectionByte ^ SelectionBits[id]; //XOR turns it off
	}
	lightButtons();
}

function newText(id)
{
	var option = document.getElementById(id);

	if (option.defaultValue != option.value)
	{
		SelectionByte = SelectionByte | SelectionBits[id]; // Or turns the bit on
	}
	else
	{
		SelectionByte = SelectionByte ^ SelectionBits[id]; //XOR turns it off
	}
	lightButtons();
}

function lightButtons()
{
	if (SelectionByte == 0)
	{
		document.getElementById("apply").disabled  = true;
	}
	else
	{
		document.getElementById("apply").disabled  = false;
	}
}
	
</script>
{% endblock %}
